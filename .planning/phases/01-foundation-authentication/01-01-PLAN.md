---
phase: 01-foundation-authentication
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - nga_app/lib/main.dart
autonomous: true
user_setup: []

must_haves:
  truths:
    - User sees loading indicator while auth state loads at startup
    - App shows main UI immediately after auth state is ready (no blocking)
    - Stored session (cookies + user info) is loaded before UI renders
  artifacts:
    - path: "nga_app/lib/main.dart"
      provides: "App initialization with splash screen"
      contains: "NgaAppWithSplash"
    - path: "nga_app/lib/screens/splash_screen.dart"
      provides: "Loading screen while auth loads"
      exports: "SplashScreen"
  key_links:
    - from: "main.dart"
      to: "NgaCookieStore.loadFromStorage"
      via: "await in main()"
      pattern: "await NgaCookieStore.loadFromStorage"
    - from: "main.dart"
      to: "NgaUserStore.loadFromStorage"
      via: "await in main()"
      pattern: "await NgaUserStore.loadFromStorage"
    - from: "splash_screen.dart"
      to: "NgaApp"
      via: "FutureBuilder + Navigator.pushReplacement"
      pattern: "FutureBuilder.*loadFromStorage"
---

<objective>
Add splash screen and proper initialization flow to prevent UI flash and ensure auth state loads before main UI renders.

Purpose: Prevents race condition where UI renders before auth state loads, showing logged-out state briefly. Provides smooth user experience with loading indicator.

Output: Working splash screen that waits for auth state, then shows main app.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-foundation-authentication/01-CONTEXT.md
@.planning/phases/01-foundation-authentication/01-RESEARCH.md
@nga_app/lib/main.dart
@nga_app/lib/src/auth/nga_cookie_store.dart
@nga_app/lib/src/auth/nga_user_store.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SplashScreen widget</name>
  <files>nga_app/lib/screens/splash_screen.dart</files>
  <action>Create new file `nga_app/lib/screens/splash_screen.dart` with:

1. SplashScreen widget that:
   - Uses FutureBuilder to wait for auth loading completion
   - Shows NGA-branded loading screen (use NGA logo from profile_drawer.dart footer)
   - Displays animated loading indicator
   - Routes to HomeScreen once auth is ready
   - Handles auth state automatically (no parameters needed)

2. The widget should:
   - Call NgaCookieStore.loadFromStorage() and NgaUserStore.loadFromStorage() internally
   - Use Future.wait to load both in parallel
   - Show a simple loading UI with logo and progress indicator
   - Navigate to HomeScreen using Navigator.pushReplacement when complete

3. Code pattern to follow:
   - Use FutureBuilder with a combined future from Future.wait
   - Use MaterialPageRoute for navigation
   - Center the logo and add loading indicator below it
</action>
  <verify>`fvm flutter analyze nga_app/lib/screens/splash_screen.dart` returns no errors</verify>
  <done>SplashScreen renders loading state then navigates to HomeScreen</done>
</task>

<task type="auto">
  <name>Task 2: Update main.dart to use SplashScreen</name>
  <files>nga_app/lib/main.dart</files>
  <action>Modify `nga_app/lib/main.dart`:

1. Remove the direct auth loading from `main()` - splash screen will handle it
2. Change `NgaApp` home from `HomeScreen()` to `SplashScreen()`
3. Keep the NgaApp widget and theme setup intact

The main() should just call:
```dart
WidgetsFlutterBinding.ensureInitialized();
runApp(const NgaApp());
```

And NgaApp should set home: SplashScreen()
</action>
  <verify>`fvm flutter analyze nga_app/lib/main.dart` returns no errors</verify>
  <done>main.dart initializes app and shows SplashScreen first</done>
</task>

</tasks>

<verification>
1. Run `fvm flutter analyze nga_app/lib/main.dart nga_app/lib/screens/splash_screen.dart` - no errors
2. Build and run app - splash screen shows with NGA branding while loading
3. After loading, app transitions to HomeScreen
4. Check debug output shows auth state loading completes
</verification>

<success_criteria>
- App shows splash screen on launch
- Splash screen displays NGA branding and loading indicator
- After auth loads, app transitions to main HomeScreen
- No flash of logged-out content on launch
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-01-SUMMARY.md`
</output>
