---
phase: 01-foundation-authentication
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - nga_app/lib/screens/login_webview_sheet.dart
autonomous: true
user_setup: []

must_haves:
  truths:
    - Modal sheet has proper iOS-style presentation (rounded corners, drag handle)
    - User sees success animation (checkmark) before WebView dismisses
    - Top bar matches app theme with proper spacing and styling
  artifacts:
    - path: "nga_app/lib/screens/login_webview_sheet.dart"
      provides: "Polished login WebView sheet with animation"
      contains: "showSuccessAndClose"
      exports: "LoginWebViewSheet"
  key_links:
    - from: "login_webview_sheet.dart"
      to: "NgaCookieStore.setCookie"
      via: "_applyCookieAndClose"
      pattern: "NgaCookieStore.setCookie.*await.*saveToStorage"
    - from: "login_webview_sheet.dart"
      to: "NgaUserStore.setUser"
      via: "_onLoginSuccessJson"
      pattern: "NgaUserStore.setUser.*userInfo"
---

<objective>
Polish the Login WebView sheet UI with iOS-style modal presentation, better top bar styling, and a success animation before dismissing.

Purpose: Current implementation is functional but "rough and unattractive" per research. Needs better aesthetics and smooth user experience.

Output: Polished login WebView sheet with proper modal sheet styling and success animation.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/01-foundation-authentication/01-CONTEXT.md
@nga_app/lib/screens/login_webview_sheet.dart
@nga_app/lib/screens/widgets/profile_drawer.dart
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add success animation before closing</name>
  <files>nga_app/lib/screens/login_webview_sheet.dart</files>
  <action>Modify `nga_app/lib/screens/login_webview_sheet.dart` to add success animation:

1. Add new state variable `_showSuccessAnimation` (bool, default false)

2. Create method `Future<void> _showSuccessAndClose()` that:
   - Sets `_showSuccessAnimation = true`
   - Waits 800ms-1s for animation to be visible
   - Then calls `Navigator.of(context).pop(true)`

3. Modify `_applyCookieAndClose()` to:
   - Call `_showSuccessAndClose()` instead of direct Navigator.pop
   - Prevent multiple captures with `_autoCaptured` guard (already exists)

4. Add a success animation widget overlay that:
   - Shows a green checkmark icon
   - Displays "登录成功" (Login successful) text
   - Uses ScaleTransition or FadeTransition for smooth appearance
   - Only visible when `_showSuccessAnimation` is true

5. Position the animation over the WebView content, centered

The animation should feel celebratory and give user feedback before the sheet closes.
</action>
  <verify>`fvm flutter analyze nga_app/lib/screens/login_webview_sheet.dart` returns no errors</verify>
  <done>User sees success checkmark animation for ~1 second before sheet dismisses</done>
</task>

<task type="auto">
  <name>Task 2: Polish modal sheet styling</name>
  <files>nga_app/lib/screens/login_webview_sheet.dart</files>
  <action>Improve the modal sheet aesthetics in `login_webview_sheet.dart`:

1. Add drag handle indicator at top of sheet (standard iOS modal pattern):
   - Small rounded bar in top center (width ~40, height ~4, radius ~2)
   - Light gray color, positioned above SafeArea

2. Improve top bar styling:
   - Match profile_drawer.dart's aesthetic (glassmorphism or subtle borders)
   - Better spacing and icon sizes
   - Use FilledButton.tonal with proper theming (already has FilledButton.tonal)

3. Ensure sheet uses full width but respects device edges:
   - Use showModalBottomSheet with proper constraints
   - backgroundColor: Colors.transparent for custom styling
   - Shape: RoundedRectangleBorder with radius (16-20)

4. Add proper SafeArea handling to avoid notches

5. Improve loading indicator visibility:
   - Make LinearProgressIndicator more visible
   - Position at top of WebView area

The goal is a polished, iOS-native feel matching the ProfileDrawer aesthetic.
</action>
  <verify>`fvm flutter analyze nga_app/lib/screens/login_webview_sheet.dart` returns no errors</verify>
  <done>Login sheet has drag handle, better styling, and matches app aesthetic</done>
</task>

</tasks>

<verification>
1. Run `fvm flutter analyze nga_app/lib/screens/login_webview_sheet.dart` - no errors
2. Build and run app
3. Open login from ProfileDrawer
4. Verify: drag handle visible at top, polished top bar, proper rounded corners
5. Complete login flow - see success animation before sheet closes
</verification>

<success_criteria>
- Modal sheet has drag handle and iOS-style presentation
- Top bar matches app theme with proper styling
- Success checkmark animation plays for ~1 second before dismiss
- Sheet closes smoothly after animation completes
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-authentication/01-02-SUMMARY.md`
</output>
