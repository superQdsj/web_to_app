---
phase: 02-forum-browsing
plan: "03"
type: execute
wave: 2
depends_on:
  - "02-01"
  - "02-02"
files_modified:
  - nga_app/lib/screens/widgets/menu_drawer_grid.dart
  - nga_app/lib/screens/home_screen.dart
autonomous: true
must_haves:
  truths:
    - MenuDrawerGrid expands/collapses categories correctly
    - Board selection highlights the active board
    - Tapping a board closes drawer and shows threads
    - Drawer handles loading and error states properly
  artifacts:
    - path: nga_app/lib/screens/widgets/menu_drawer_grid.dart
      provides: "Working grid-based accordion drawer"
      min_lines: 50
  key_links:
    - from: MenuDrawerGrid._buildBoardCard
      to: NgaForumStore.setActiveFid
      via: "onTap handler that calls setActiveFid then Navigator.pop"
---

<objective>
Verify and polish MenuDrawerGrid to ensure smooth drawer navigation.

Purpose: MenuDrawerGrid exists but needs verification that all features work correctly - category expansion, board selection highlighting, and proper drawer closing.

Output: Verified and polished MenuDrawerGrid with:
- Smooth expand/collapse animations for categories
- Active board highlighting
- Proper drawer close after selection
- Loading and error state handling
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@nga_app/lib/screens/widgets/menu_drawer_grid.dart
@nga_app/lib/screens/widgets/menu_drawer.dart
@.planning/research/
</context>

<tasks>

<task type="auto">
  <name>Verify category expansion behavior</name>
  <files>nga_app/lib/screens/widgets/menu_drawer_grid.dart</files>
  <action>
    Review and verify the category expansion logic:

    1. Check `_expandedCategories` Set is properly managed
    2. Verify `AnimatedCrossFade` properly shows/hides subcategories
    3. Ensure the expand arrow animation works (`AnimatedRotation`)
    4. Test that tapping category header toggles expansion

    Look for any issues:
    - Does expansion persist when reopening drawer?
    - Is the animation smooth (250ms duration)?
    - Does tapping outside close expanded sections?

    Fix any issues found.
  </action>
  <verify>Categories expand/collapse with smooth animation</verify>
  <done>Category expansion works smoothly with visual feedback</done>
</task>

<task type="auto">
  <name>Verify board selection and highlighting</name>
  <files>nga_app/lib/screens/widgets/menu_drawer_grid.dart</files>
  <action>
    Review and verify board card behavior:

    1. Check `ValueListenableBuilder<NgaForumStore.activeFid>` is wrapping each board card
    2. Verify `isActive = activeFid == board.fid` comparison works
    3. Confirm visual changes when active:
       - Border color changes to _primaryColor
       - Opacity increases
       - Box shadow appears

    4. Check onTap handler:
       - Calls `NgaForumStore.setActiveFid(board.fid)`
       - Calls `Navigator.pop(context)` to close drawer

    5. Verify network icons load properly with error fallback
  </action>
  <verify>Active board is visually highlighted, tapping closes drawer</verify>
  <done>Board selection highlights active board and closes drawer</done>
</task>

<task type="auto">
  <name>Fix any issues found</name>
  <files>nga_app/lib/screens/widgets/menu_drawer_grid.dart</files>
  <action>
    Based on findings from tasks 1 and 2, fix any issues:

    Common issues to check and fix:
    - Null safety issues
    - Animation timing
    - Icon loading errors
    - Layout issues on different screen sizes
    - Dark mode colors

    Run flutter analyze and fix any warnings/errors.
  </action>
  <verify>flutter analyze passes with no warnings</verify>
  <done>All issues in MenuDrawerGrid are fixed</done>
</task>

</tasks>

<verification>
1. Run `cd nga_app && fvm flutter analyze` - no errors or warnings
2. Open drawer - categories display correctly
3. Tap a category - it expands smoothly
4. Tap a board - it highlights and drawer closes
5. Reopen drawer - previously selected board is highlighted
6. Check dark mode support works
</verification>

<success_criteria>
- [ ] flutter analyze passes with no warnings
- [ ] Categories expand/collapse with smooth animation
- [ ] Active board is visually highlighted
- [ ] Tapping board closes drawer and shows threads
- [ ] Dark mode colors work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/02-forum-browsing/02-03-SUMMARY.md`
</output>
