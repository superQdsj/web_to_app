---
phase: 02-forum-browsing
plan: "02"
type: execute
wave: 1
depends_on: []
files_modified:
  - nga_app/lib/screens/forum_screen.dart
  - nga_app/lib/screens/home_screen.dart
autonomous: true
must_haves:
  truths:
    - User can see which board is currently selected
    - User has quick access to change boards while viewing threads
    - App bar shows current board name when board is selected
    - Thread list displays threads when board is selected
  artifacts:
    - path: nga_app/lib/screens/forum_screen.dart
      provides: "Board header showing current board"
      min_lines: 20
    - path: nga_app/lib/screens/home_screen.dart
      provides: "Dynamic app bar title"
      min_lines: 10
  key_links:
    - from: ForumContent
      to: NgaForumStore.activeFid
      via: "ValueListenableBuilder showing board name"
    - from: HomeScreen
      to: NgaForumStore.activeFid
      via: "App bar title updates"
---

<objective>
Add board selection UX improvements: current board indicator and quick drawer access.

Purpose: When viewing threads, users should know which board they're in and have an easy way to switch boards without navigating back.

Output:
1. ForumContent shows a header bar with current board name when board is selected
2. Header includes a "切换版块" button to quickly reopen the drawer
3. HomeScreen app bar shows board name when active, "NGA Forum" when not
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@nga_app/lib/screens/forum_screen.dart
@nga_app/lib/screens/home_screen.dart
@nga_app/lib/src/nga_forum_store.dart
@nga_app/lib/src/model/forum_category.dart
</context>

<tasks>

<task type="auto">
  <name>Add board header to ForumContent</name>
  <files>nga_app/lib/screens/forum_screen.dart</files>
  <action>
    Modify ForumContent to show a header bar when a board is active:

    1. First, add a method to get board name from fid - create a simple lookup or store board info when selected. The simplest approach: pass board name through NgaForumStore or create a board name cache.

    2. Add a `_buildBoardHeader()` method that returns a Container with:
       - Board name text (bold, 16sp)
       - "切换版块" trailing button that opens drawer
       - Background color using theme's primary color with opacity

    3. Modify `_buildBody()` to wrap the list with this header when `_activeFid != null`:
       ```dart
       if (_activeFid != null) ...[_buildBoardHeader(), Expanded(child: ListView...)],
       ```

    4. Keep existing empty state logic unchanged.

    For board name lookup, use a simple Map<int, String> cache that gets populated when boards are selected. You can get board name from MenuDrawer when it's selected, or store it in NgaForumStore.

    Alternative simpler approach: Just show "当前版块" without the name, or make NgaForumStore store both fid and name.
  </action>
  <verify>flutter analyze passes and board header appears when board selected</verify>
  <done>Board header with name and switch button shows above thread list</done>
</task>

<task type="auto">
  <name>Update HomeScreen app bar dynamically</name>
  <files>nga_app/lib/screens/home_screen.dart</files>
  <action>
    Modify the app bar title to show current board name when a board is selected:

    1. Create a helper method to get board name from fid (similar to above)
    2. Wrap the Text widget in a ValueListenableBuilder that listens to NgaForumStore.activeFid
    3. When activeFid is null, show "NGA Forum"
    4. When activeFid has a value, show the board name

    The board name lookup can be done by:
    - Loading categories and finding the board by fid (expensive on every rebuild)
    - Caching the last selected board name in NgaForumStore (recommended)

    For now, keep it simple: show "已选择版块" or fetch board name once and cache it.
  </action>
  <verify>flutter analyze passes and app bar updates when board selected</verify>
  <done>App bar shows board name when active, "NGA Forum" when not</done>
</task>

</tasks>

<verification>
1. Run `cd nga_app && fvm flutter analyze` - no errors
2. Select a board from drawer - app bar shows the board name
3. ForumContent shows header with board name above thread list
4. Thread list displays actual threads (not empty state) - CONFIRM threads render
5. "切换版块" button reopens the drawer for quick switching
</verification>

<success_criteria>
- [ ] App bar displays current board name when board selected
- [ ] ForumContent shows header above thread list
- [ ] Thread list actually renders threads when board selected
- [ ] Header button opens drawer for board switching
- [ ] flutter analyze passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-forum-browsing/02-02-SUMMARY.md`
</output>
